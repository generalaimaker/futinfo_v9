// 포메이션별 정확한 선수 위치 정의
// API-Football의 grid 시스템: "row:col" 형식
// row: 1(GK), 2(DEF), 3(MID), 4(ATT-MID/WING), 5(FW)
// col: 각 라인에서의 좌우 위치

interface Position {
  x: number  // 전진 정도 (홈: 0-50, 원정: 50-100)
  y: number  // 좌우 위치 (0-100)
}

interface FormationPositions {
  [key: string]: Position  // "row:col" 형식의 키
}

// 프로팀이 자주 사용하는 12가지 포메이션별 홈팀 위치 정의
const HOME_FORMATIONS: { [formation: string]: FormationPositions } = {
  // 4-4-2 (플랫 또는 다이아몬드)
  '4-4-2': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (4명) - 플랫 백포 (모두 같은 x 좌표)
    '2:1': { x: 15, y: 12 },  // LB (왼쪽은 위쪽)
    '2:2': { x: 15, y: 35 },  // LCB
    '2:3': { x: 15, y: 65 },  // RCB
    '2:4': { x: 15, y: 88 },  // RB (오른쪽은 아래쪽)
    // MID (4명) - 플랫 미드필드 (모두 같은 x 좌표)
    '3:1': { x: 28, y: 8 },   // LM (왼쪽은 위쪽)
    '3:2': { x: 28, y: 35 },  // LCM
    '3:3': { x: 28, y: 65 },  // RCM
    '3:4': { x: 28, y: 92 },  // RM (오른쪽은 아래쪽)
    // FW (2명) - 투톱 (같은 x 좌표)
    '4:1': { x: 42, y: 35 },  // LS
    '4:2': { x: 42, y: 65 },  // RS
    '5:1': { x: 42, y: 35 },  // Alternative FW position
    '5:2': { x: 42, y: 65 },  // Alternative FW position
  },
  
  // 4-3-3 (윙어 포함)
  '4-3-3': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (4명) - 플랫 백포
    '2:1': { x: 15, y: 12 },  // LB (왼쪽은 위쪽)
    '2:2': { x: 15, y: 35 },  // LCB
    '2:3': { x: 15, y: 65 },  // RCB
    '2:4': { x: 15, y: 88 },  // RB (오른쪽은 아래쪽)
    // MID (3명) - 플랫 미드필드 (모두 같은 라인)
    '3:1': { x: 26, y: 25 },  // LCM (왼쪽은 위쪽)
    '3:2': { x: 26, y: 50 },  // CDM (중앙)
    '3:3': { x: 26, y: 75 },  // RCM (오른쪽은 아래쪽)
    // WING/FW (3명) - 같은 라인
    '4:1': { x: 40, y: 10 },  // LW (왼쪽 윙은 위쪽)
    '4:2': { x: 40, y: 50 },  // CF
    '4:3': { x: 40, y: 90 },  // RW (오른쪽 윙은 아래쪽)
    '5:1': { x: 40, y: 50 },  // Alternative CF position
  },
  
  // 4-2-3-1 (현대 축구 인기 포메이션)
  '4-2-3-1': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (4명) - 플랫 백포
    '2:1': { x: 15, y: 12 },  // LB (왼쪽은 위쪽)
    '2:2': { x: 15, y: 35 },  // LCB
    '2:3': { x: 15, y: 65 },  // RCB
    '2:4': { x: 15, y: 88 },  // RB (오른쪽은 아래쪽)
    // DM (2명) - 더블 피봇 (같은 라인)
    '3:1': { x: 23, y: 35 },  // LDM (왼쪽은 위쪽)
    '3:2': { x: 23, y: 65 },  // RDM (오른쪽은 아래쪽)
    // AM (3명) - 공격형 미드필더 (같은 라인)
    '4:1': { x: 34, y: 12 },  // LAM (좌측 공격형은 위쪽)
    '4:2': { x: 34, y: 50 },  // CAM (중앙 공격형)
    '4:3': { x: 34, y: 88 },  // RAM (우측 공격형은 아래쪽)
    // FW (1명)
    '5:1': { x: 44, y: 50 },  // ST
  },
  
  // 3-5-2 (윙백 시스템)
  '3-5-2': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (3명) - 쓰리백 (같은 라인)
    '2:1': { x: 15, y: 25 },  // LCB (왼쪽은 위쪽)
    '2:2': { x: 15, y: 50 },  // CB
    '2:3': { x: 15, y: 75 },  // RCB (오른쪽은 아래쪽)
    // MID (5명) - 윙백 포함
    '3:1': { x: 25, y: 5 },   // LWB (왼쪽 윙백은 위쪽)
    '3:2': { x: 26, y: 30 },  // LCM (왼쪽은 위쪽)
    '3:3': { x: 25, y: 50 },  // CDM (중간 위치)
    '3:4': { x: 26, y: 70 },  // RCM (오른쪽은 아래쪽)
    '3:5': { x: 25, y: 95 },  // RWB (오른쪽 윙백은 아래쪽)
    // FW (2명) - 투톱 (같은 라인)
    '4:1': { x: 42, y: 35 },  // LS (왼쪽 스트라이커)
    '4:2': { x: 42, y: 65 },  // RS (오른쪽 스트라이커)
    '5:1': { x: 42, y: 35 },  // Alternative FW
    '5:2': { x: 42, y: 65 },  // Alternative FW
  },
  
  // 5-4-1 (수비적 포메이션)
  '5-4-1': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (5명) - 파이브백 (모두 같은 x 좌표)
    '2:1': { x: 15, y: 5 },   // LWB (왼쪽 윙백은 위쪽)
    '2:2': { x: 15, y: 28 },  // LCB (왼쪽은 위쪽)
    '2:3': { x: 15, y: 50 },  // CB
    '2:4': { x: 15, y: 72 },  // RCB (오른쪽은 아래쪽)
    '2:5': { x: 15, y: 95 },  // RWB (오른쪽 윙백은 아래쪽)
    // MID (4명) - 플랫 미드필드 (모두 같은 x 좌표)
    '3:1': { x: 26, y: 15 },  // LM (왼쪽은 위쪽)
    '3:2': { x: 26, y: 38 },  // LCM
    '3:3': { x: 26, y: 62 },  // RCM
    '3:4': { x: 26, y: 85 },  // RM (오른쪽은 아래쪽)
    // FW (1명)
    '4:1': { x: 42, y: 50 },  // ST
    '5:1': { x: 42, y: 50 },  // Alternative ST
  },
  
  // 4-5-1 (중원 장악)
  '4-5-1': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (4명) - 플랫 백포 (모두 같은 x 좌표)
    '2:1': { x: 15, y: 12 },  // LB (왼쪽은 위쪽)
    '2:2': { x: 15, y: 35 },  // LCB
    '2:3': { x: 15, y: 65 },  // RCB
    '2:4': { x: 15, y: 88 },  // RB (오른쪽은 아래쪽)
    // MID (5명) - 중원 압박 (윙과 중앙 미드필더 라인 정렬)
    '3:1': { x: 26, y: 8 },   // LM (왼쪽은 위쪽)
    '3:2': { x: 26, y: 30 },  // LCM
    '3:3': { x: 25, y: 50 },  // CDM (중간 위치)
    '3:4': { x: 26, y: 70 },  // RCM
    '3:5': { x: 26, y: 92 },  // RM (오른쪽은 아래쪽)
    // FW (1명)
    '4:1': { x: 42, y: 50 },  // ST
    '5:1': { x: 42, y: 50 },  // Alternative ST
  },
  
  // 3-4-3 (공격적 포메이션)
  '3-4-3': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (3명) - 쓰리백 (모두 같은 x 좌표)
    '2:1': { x: 15, y: 25 },  // LCB (왼쪽은 위쪽)
    '2:2': { x: 15, y: 50 },  // CB
    '2:3': { x: 15, y: 75 },  // RCB (오른쪽은 아래쪽)
    // MID (4명) - 윙백과 중앙 미드필더
    '3:1': { x: 25, y: 5 },   // LWB (왼쪽 윙백은 위쪽)
    '3:2': { x: 26, y: 35 },  // LCM (왼쪽은 위쪽)
    '3:3': { x: 26, y: 65 },  // RCM (오른쪽은 아래쪽)
    '3:4': { x: 25, y: 95 },  // RWB (오른쪽 윙백은 아래쪽)
    // FW (3명) - 쓰리톱 (윙어는 같은 라인)
    '4:1': { x: 40, y: 12 },  // LW (왼쪽 윙은 위쪽)
    '4:2': { x: 40, y: 50 },  // CF
    '4:3': { x: 40, y: 88 },  // RW (오른쪽 윙은 아래쪽)
    '5:1': { x: 40, y: 50 },  // Alternative CF
  },
  
  // 5-3-2 (수비 중시)
  '5-3-2': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (5명) - 파이브백 (모두 같은 x 좌표)
    '2:1': { x: 15, y: 5 },   // LWB (왼쪽 윙백은 위쪽)
    '2:2': { x: 15, y: 28 },  // LCB (왼쪽은 위쪽)
    '2:3': { x: 15, y: 50 },  // CB
    '2:4': { x: 15, y: 72 },  // RCB (오른쪽은 아래쪽)
    '2:5': { x: 15, y: 95 },  // RWB (오른쪽 윙백은 아래쪽)
    // MID (3명) - 플랫 미드필드
    '3:1': { x: 26, y: 25 },  // LCM (왼쪽은 위쪽)
    '3:2': { x: 26, y: 50 },  // CDM (같은 라인)
    '3:3': { x: 26, y: 75 },  // RCM (오른쪽은 아래쪽)
    // FW (2명) - 투톱 (같은 x 좌표)
    '4:1': { x: 42, y: 35 },  // LS (왼쪽 스트라이커)
    '4:2': { x: 42, y: 65 },  // RS (오른쪽 스트라이커)
    '5:1': { x: 42, y: 35 },  // Alternative LS
    '5:2': { x: 42, y: 65 },  // Alternative RS
  },
  
  
  // 3-4-2-1 (크리스마스 트리)
  '3-4-2-1': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (3명) - 쓰리백 (모두 같은 x 좌표)
    '2:1': { x: 15, y: 25 },  // LCB (왼쪽은 위쪽)
    '2:2': { x: 15, y: 50 },  // CB
    '2:3': { x: 15, y: 75 },  // RCB (오른쪽은 아래쪽)
    // MID (4명) - 윙백과 중앙 미드필더
    '3:1': { x: 25, y: 5 },   // LWB (왼쪽 윙백은 위쪽)
    '3:2': { x: 26, y: 35 },  // LCM (왼쪽은 위쪽)
    '3:3': { x: 26, y: 65 },  // RCM (오른쪽은 아래쪽)
    '3:4': { x: 25, y: 95 },  // RWB (오른쪽 윙백은 아래쪽)
    // AM (2명) - 공격형 미드필더 (같은 x 좌표)
    '4:1': { x: 35, y: 30 },  // LAM (왼쪽은 위쪽)
    '4:2': { x: 35, y: 70 },  // RAM (오른쪽은 아래쪽)
    // FW (1명)
    '5:1': { x: 44, y: 50 },  // ST
  },
  
  // 4-2-2-2 (박스 미드필드)
  '4-2-2-2': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (4명) - 플랫 백포 (모두 같은 x 좌표)
    '2:1': { x: 15, y: 12 },  // LB (왼쪽은 위쪽)
    '2:2': { x: 15, y: 35 },  // LCB
    '2:3': { x: 15, y: 65 },  // RCB
    '2:4': { x: 15, y: 88 },  // RB (오른쪽은 아래쪽)
    // DM (2명) - 더블 피봇 (같은 x 좌표)
    '3:1': { x: 23, y: 35 },  // LDM (왼쪽은 위쪽)
    '3:2': { x: 23, y: 65 },  // RDM (오른쪽은 아래쪽)
    // AM (2명) - 박스 투 박스 (같은 x 좌표)
    '4:1': { x: 32, y: 35 },  // LAM (왼쪽은 위쪽)
    '4:2': { x: 32, y: 65 },  // RAM (오른쪽은 아래쪽)
    // FW (2명) - 투톱 (같은 x 좌표)
    '5:1': { x: 42, y: 35 },  // LS (왼쪽 스트라이커)
    '5:2': { x: 42, y: 65 },  // RS (오른쪽 스트라이커)
  },
  
  // 5-2-3 (압박 축구)
  '5-2-3': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (5명) - 파이브백 (모두 같은 x 좌표)
    '2:1': { x: 15, y: 5 },   // LWB (왼쪽 윙백은 위쪽)
    '2:2': { x: 15, y: 28 },  // LCB (왼쪽은 위쪽)
    '2:3': { x: 15, y: 50 },  // CB
    '2:4': { x: 15, y: 72 },  // RCB (오른쪽은 아래쪽)
    '2:5': { x: 15, y: 95 },  // RWB (오른쪽 윙백은 아래쪽)
    // MID (2명) - 더블 피봇 (같은 x 좌표)
    '3:1': { x: 24, y: 35 },  // LCM (왼쪽은 위쪽)
    '3:2': { x: 24, y: 65 },  // RCM (오른쪽은 아래쪽)
    // FW (3명) - 쓰리톱 (같은 x 좌표)
    '4:1': { x: 40, y: 12 },  // LW (왼쪽 윙은 위쪽)
    '4:2': { x: 40, y: 50 },  // CF
    '4:3': { x: 40, y: 88 },  // RW (오른쪽 윙은 아래쪽)
    '5:1': { x: 40, y: 50 },  // Alternative CF
  },

  // 4-1-4-1 (수비형 미드필더 하나)
  '4-1-4-1': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (4명) - 한 줄에 정렬
    '2:1': { x: 15, y: 12 },  // LB (왼쪽은 위쪽)
    '2:2': { x: 15, y: 35 },  // LCB
    '2:3': { x: 15, y: 65 },  // RCB
    '2:4': { x: 15, y: 88 },  // RB (오른쪽은 아래쪽)
    // DM (1명) - 중앙 수비형 미드필더
    '3:1': { x: 23, y: 50 },  // CDM (홀로 중앙)
    // MID (4명) - 공격형 미드필더, 한 줄에 정렬
    '4:1': { x: 32, y: 8 },   // LM (왼쪽은 위쪽)
    '4:2': { x: 32, y: 35 },  // LCM
    '4:3': { x: 32, y: 65 },  // RCM
    '4:4': { x: 32, y: 92 },  // RM (오른쪽은 아래쪽)
    // FW (1명)
    '5:1': { x: 44, y: 50 },  // ST
  },

  // 4-4-1-1 (미드필드 다이아몬드)
  '4-4-1-1': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (4명)
    '2:1': { x: 15, y: 12 },  // LB (왼쪽은 위쪽)
    '2:2': { x: 15, y: 35 },  // LCB
    '2:3': { x: 15, y: 65 },  // RCB
    '2:4': { x: 15, y: 88 },  // RB (오른쪽은 아래쪽)
    // MID (4명) - 다이아몬드 형태
    '3:1': { x: 22, y: 50 },  // CDM (후방)
    '3:2': { x: 28, y: 25 },  // LCM (왼쪽은 위쪽)
    '3:3': { x: 28, y: 75 },  // RCM (오른쪽은 아래쪽)
    '3:4': { x: 32, y: 50 },  // CAM (전방)
    // SS/CF (1명) - 세컨드 스트라이커
    '4:1': { x: 38, y: 50 },  // SS
    // FW (1명)
    '5:1': { x: 44, y: 50 },  // ST
  }
}

// 원정팀 위치 생성 (홈팀 기준으로 자동 변환)
function generateAwayPositions(homePositions: FormationPositions): FormationPositions {
  const awayPositions: FormationPositions = {}
  
  for (const [key, pos] of Object.entries(homePositions)) {
    // x축 반전 (홈팀 0-50 -> 원정팀 50-100)
    // y축 반전 (좌우 미러링)
    awayPositions[key] = {
      x: 100 - pos.x,  // x축 반전
      y: 100 - pos.y   // y축 반전 (좌우 미러링)
    }
  }
  
  return awayPositions
}

// 원정팀 포메이션 생성
const AWAY_FORMATIONS: { [formation: string]: FormationPositions } = {}
for (const [formation, positions] of Object.entries(HOME_FORMATIONS)) {
  AWAY_FORMATIONS[formation] = generateAwayPositions(positions)
}

// 기본 포지션 (포메이션 정보가 없을 때)
const DEFAULT_POSITIONS = {
  home: {
    '1:1': { x: 5, y: 50 },    // GK
    '2:1': { x: 15, y: 15 },   // DEF (왼쪽은 위쪽)
    '2:2': { x: 15, y: 35 },
    '2:3': { x: 15, y: 50 },   // 중앙
    '2:4': { x: 15, y: 65 },
    '2:5': { x: 15, y: 85 },   // 5번째 수비수 (오른쪽은 아래쪽)
    '3:1': { x: 26, y: 20 },   // MID (왼쪽은 위쪽)
    '3:2': { x: 26, y: 40 },
    '3:3': { x: 26, y: 50 },   // 중앙
    '3:4': { x: 26, y: 60 },
    '3:5': { x: 26, y: 80 },   // 5번째 미드필더 (오른쪽은 아래쪽)
    '4:1': { x: 36, y: 15 },   // ATT (왼쪽은 위쪽)
    '4:2': { x: 36, y: 50 },   // 중앙
    '4:3': { x: 36, y: 85 },   // 오른쪽은 아래쪽
    '4:4': { x: 36, y: 35 },   // 4번째 공격수
    '5:1': { x: 44, y: 35 },   // FW (왼쪽)
    '5:2': { x: 44, y: 65 },   // 2번째 FW (오른쪽)
    '5:3': { x: 44, y: 50 },   // 3번째 FW (중앙)
  },
  away: {}
}
DEFAULT_POSITIONS.away = generateAwayPositions(DEFAULT_POSITIONS.home)

// 포지션 가져오기 함수
export function getPosition(
  grid: string, 
  isHomeTeam: boolean, 
  formation?: string
): Position {
  // 포메이션이 있으면 해당 포메이션 사용
  if (formation) {
    const positions = isHomeTeam ? HOME_FORMATIONS[formation] : AWAY_FORMATIONS[formation]
    if (positions && positions[grid]) {
      return positions[grid]
    }
  }
  
  // 포메이션이 없거나 매칭되지 않으면 기본값 사용
  const defaultPos = isHomeTeam ? DEFAULT_POSITIONS.home : DEFAULT_POSITIONS.away
  return defaultPos[grid] || { x: isHomeTeam ? 25 : 75, y: 50 }
}

// 지원하는 포메이션 목록
export const SUPPORTED_FORMATIONS = [
  '4-4-2',
  '4-3-3',
  '4-2-3-1',
  '3-5-2',
  '5-4-1',
  '4-5-1',
  '3-4-3',
  '5-3-2',
  '4-1-4-1',
  '4-4-1-1',
  '3-4-2-1',
  '4-2-2-2',
  '5-2-3'
]

// Export formations for debugging
export { HOME_FORMATIONS, AWAY_FORMATIONS, DEFAULT_POSITIONS }