// 포메이션별 정확한 선수 위치 정의
// API-Football의 grid 시스템: "row:col" 형식
// row: 1(GK), 2(DEF), 3(MID), 4(ATT-MID/WING), 5(FW)
// col: 각 라인에서의 좌우 위치

interface Position {
  x: number  // 전진 정도 (홈: 0-50, 원정: 50-100)
  y: number  // 좌우 위치 (0-100)
}

interface FormationPositions {
  [key: string]: Position  // "row:col" 형식의 키
}

// 프로팀이 자주 사용하는 12가지 포메이션별 홈팀 위치 정의
// X 좌표: 홈팀은 0-50 (왼쪽 절반만), 원정팀은 50-100 (오른쪽 절반만)
// Y 좌표: 상단(0) -> 중앙(50) -> 하단(100)
const HOME_FORMATIONS: { [formation: string]: FormationPositions } = {
  // 4-4-2 (플랫 또는 다이아몬드)
  '4-4-2': {
    // GK - 골대 바로 앞
    '1:1': { x: 5, y: 50 },
    // DEF (4명) - 골키퍼와 매우 가깝게, 최대한 넓게 퍼짐
    '2:1': { x: 10, y: 10 },  // LB - 최대 사이드
    '2:2': { x: 10, y: 35 },  // LCB - 넓게
    '2:3': { x: 10, y: 65 },  // RCB - 넓게
    '2:4': { x: 10, y: 90 },  // RB - 최대 사이드
    // MID (4명) - 수비와 적절한 간격 유지
    '3:1': { x: 25, y: 8 },   // LM - 사이드
    '3:2': { x: 25, y: 33 },  // LCM
    '3:3': { x: 25, y: 67 },  // RCM
    '3:4': { x: 25, y: 92 },  // RM - 사이드
    // FW (2명) - 센터라인 근처
    '4:1': { x: 40, y: 35 },  // LS
    '4:2': { x: 40, y: 65 },  // RS
    '5:1': { x: 40, y: 35 },  // Alternative FW position
    '5:2': { x: 40, y: 65 },  // Alternative FW position
  },
  
  // 4-3-3 (윙어 포함)
  '4-3-3': {
    // GK - 골대 바로 앞
    '1:1': { x: 5, y: 50 },
    // DEF (4명) - 골키퍼와 매우 가깝게, 최대한 넓게 퍼짐
    '2:1': { x: 10, y: 10 },  // LB - 최대 사이드
    '2:2': { x: 10, y: 35 },  // LCB - 넓게
    '2:3': { x: 10, y: 65 },  // RCB - 넓게
    '2:4': { x: 10, y: 90 },  // RB - 최대 사이드
    // MID (3명) - 중앙 지역 (간격 넓힘)
    '3:1': { x: 24, y: 20 },  // LCM - 더 넓게
    '3:2': { x: 24, y: 50 },  // CDM - 정중앙
    '3:3': { x: 24, y: 80 },  // RCM - 더 넓게
    // WING/FW (3명) - 전방 (미드필더와 같은 간격)
    '4:1': { x: 38, y: 20 },  // LW - 미드필더와 같은 간격
    '4:2': { x: 38, y: 50 },  // CF - 중앙
    '4:3': { x: 38, y: 80 },  // RW - 미드필더와 같은 간격
    '5:1': { x: 38, y: 50 },  // Alternative CF position
  },
  
  // 4-2-3-1 (현대 축구 인기 포메이션)
  '4-2-3-1': {
    // GK - 골대 바로 앞
    '1:1': { x: 5, y: 50 },
    // DEF (4명) - 골키퍼와 매우 가깝게, 최대한 넓게 퍼짐
    '2:1': { x: 10, y: 10 },  // LB - 최대 사이드
    '2:2': { x: 10, y: 35 },  // LCB - 넓게
    '2:3': { x: 10, y: 65 },  // RCB - 넓게
    '2:4': { x: 10, y: 90 },  // RB - 최대 사이드
    // DM (2명) - 수비형 미드필더
    '3:1': { x: 20, y: 35 },  // LDM
    '3:2': { x: 20, y: 65 },  // RDM
    // AM (3명) - 공격형 미드필더
    '4:1': { x: 32, y: 15 },  // LAM - 사이드
    '4:2': { x: 32, y: 50 },  // CAM - 중앙
    '4:3': { x: 32, y: 85 },  // RAM - 사이드
    // FW (1명) - 최전방
    '5:1': { x: 42, y: 50 },  // ST - 중앙
  },
  
  // 3-5-2 (윙백 시스템)
  '3-5-2': {
    // GK - 골대 바로 앞
    '1:1': { x: 5, y: 50 },
    // DEF (3명) - 쓰리백
    '2:1': { x: 12, y: 30 },  // LCB
    '2:2': { x: 12, y: 50 },  // CB - 정중앙
    '2:3': { x: 12, y: 70 },  // RCB
    // MID (5명) - 윙백 포함
    '3:1': { x: 26, y: 8 },   // LWB - 사이드라인
    '3:2': { x: 26, y: 32 },  // LCM
    '3:3': { x: 24, y: 50 },  // CDM - 약간 뒤
    '3:4': { x: 26, y: 68 },  // RCM
    '3:5': { x: 26, y: 92 },  // RWB - 사이드라인
    // FW (2명) - 투톱
    '4:1': { x: 42, y: 38 },  // LS
    '4:2': { x: 42, y: 62 },  // RS
    '5:1': { x: 42, y: 38 },  // Alternative FW
    '5:2': { x: 42, y: 62 },  // Alternative FW
  },
  
  // 5-4-1 (수비적 포메이션)
  '5-4-1': {
    // GK - 골대 바로 앞
    '1:1': { x: 5, y: 50 },
    // DEF (5명) - 파이브백, 더 넓게
    '2:1': { x: 12, y: 8 },   // LWB - 사이드
    '2:2': { x: 12, y: 28 },  // LCB
    '2:3': { x: 12, y: 50 },  // CB - 정중앙
    '2:4': { x: 12, y: 72 },  // RCB
    '2:5': { x: 12, y: 92 },  // RWB - 사이드
    // MID (4명) - 플랫 미드필드
    '3:1': { x: 26, y: 18 },  // LM
    '3:2': { x: 26, y: 38 },  // LCM
    '3:3': { x: 26, y: 62 },  // RCM
    '3:4': { x: 26, y: 82 },  // RM
    // FW (1명) - 최전방
    '4:1': { x: 40, y: 50 },  // ST - 중앙
    '5:1': { x: 40, y: 50 },  // Alternative ST
  },
  
  // 4-5-1 (중원 장악)
  '4-5-1': {
    // GK - 골대 바로 앞
    '1:1': { x: 5, y: 50 },
    // DEF (4명) - 골키퍼와 매우 가깝게, 최대한 넓게
    '2:1': { x: 10, y: 10 },  // LB - 최대 사이드
    '2:2': { x: 10, y: 35 },  // LCB - 넓게
    '2:3': { x: 10, y: 65 },  // RCB - 넓게
    '2:4': { x: 10, y: 90 },  // RB - 최대 사이드
    // MID (5명) - 중원 압박
    '3:1': { x: 24, y: 8 },   // LM - 사이드
    '3:2': { x: 24, y: 28 },  // LCM
    '3:3': { x: 22, y: 50 },  // CDM - 약간 뒤
    '3:4': { x: 24, y: 72 },  // RCM
    '3:5': { x: 24, y: 92 },  // RM - 사이드
    // FW (1명) - 최전방
    '4:1': { x: 38, y: 50 },  // ST - 중앙
    '5:1': { x: 38, y: 50 },  // Alternative ST
  },
  
  // 3-4-3 (공격적 포메이션)
  '3-4-3': {
    // GK - 골대 바로 앞
    '1:1': { x: 5, y: 50 },
    // DEF (3명) - 쓰리백
    '2:1': { x: 12, y: 30 },  // LCB
    '2:2': { x: 12, y: 50 },  // CB - 정중앙
    '2:3': { x: 12, y: 70 },  // RCB
    // MID (4명) - 윙백과 중앙 미드필더
    '3:1': { x: 26, y: 8 },   // LWB - 사이드
    '3:2': { x: 26, y: 35 },  // LCM
    '3:3': { x: 26, y: 65 },  // RCM
    '3:4': { x: 26, y: 92 },  // RWB - 사이드
    // FW (3명) - 쓰리톱 
    '4:1': { x: 40, y: 18 },  // LW - 사이드
    '4:2': { x: 40, y: 50 },  // CF - 중앙
    '4:3': { x: 40, y: 82 },  // RW - 사이드
    '5:1': { x: 40, y: 50 },  // Alternative CF
  },
  
  // 5-3-2 (수비 중시)
  '5-3-2': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (5명) - 파이브백 (모두 같은 x 좌표)
    '2:1': { x: 15, y: 5 },   // LWB (왼쪽 윙백은 위쪽)
    '2:2': { x: 15, y: 28 },  // LCB (왼쪽은 위쪽)
    '2:3': { x: 15, y: 50 },  // CB
    '2:4': { x: 15, y: 72 },  // RCB (오른쪽은 아래쪽)
    '2:5': { x: 15, y: 95 },  // RWB (오른쪽 윙백은 아래쪽)
    // MID (3명) - 플랫 미드필드
    '3:1': { x: 26, y: 25 },  // LCM (왼쪽은 위쪽)
    '3:2': { x: 26, y: 50 },  // CDM (같은 라인)
    '3:3': { x: 26, y: 75 },  // RCM (오른쪽은 아래쪽)
    // FW (2명) - 투톱 (같은 x 좌표)
    '4:1': { x: 42, y: 35 },  // LS (왼쪽 스트라이커)
    '4:2': { x: 42, y: 65 },  // RS (오른쪽 스트라이커)
    '5:1': { x: 42, y: 35 },  // Alternative LS
    '5:2': { x: 42, y: 65 },  // Alternative RS
  },
  
  
  // 3-4-2-1 (크리스마스 트리)
  '3-4-2-1': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (3명) - 쓰리백 (모두 같은 x 좌표)
    '2:1': { x: 15, y: 25 },  // LCB (왼쪽은 위쪽)
    '2:2': { x: 15, y: 50 },  // CB
    '2:3': { x: 15, y: 75 },  // RCB (오른쪽은 아래쪽)
    // MID (4명) - 윙백과 중앙 미드필더
    '3:1': { x: 25, y: 5 },   // LWB (왼쪽 윙백은 위쪽)
    '3:2': { x: 26, y: 35 },  // LCM (왼쪽은 위쪽)
    '3:3': { x: 26, y: 65 },  // RCM (오른쪽은 아래쪽)
    '3:4': { x: 25, y: 95 },  // RWB (오른쪽 윙백은 아래쪽)
    // AM (2명) - 공격형 미드필더 (같은 x 좌표)
    '4:1': { x: 35, y: 30 },  // LAM (왼쪽은 위쪽)
    '4:2': { x: 35, y: 70 },  // RAM (오른쪽은 아래쪽)
    // FW (1명)
    '5:1': { x: 44, y: 50 },  // ST
  },
  
  // 4-2-2-2 (박스 미드필드)
  '4-2-2-2': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (4명) - 골키퍼와 매우 가깝게, 최대한 넓게
    '2:1': { x: 10, y: 10 },  // LB - 최대 사이드
    '2:2': { x: 10, y: 35 },  // LCB - 넓게
    '2:3': { x: 10, y: 65 },  // RCB - 넓게
    '2:4': { x: 10, y: 90 },  // RB - 최대 사이드
    // DM (2명) - 더블 피봇
    '3:1': { x: 20, y: 35 },  // LDM
    '3:2': { x: 20, y: 65 },  // RDM
    // AM (2명) - 박스 투 박스
    '4:1': { x: 30, y: 35 },  // LAM
    '4:2': { x: 30, y: 65 },  // RAM
    // FW (2명) - 투톱
    '5:1': { x: 40, y: 35 },  // LS
    '5:2': { x: 40, y: 65 },  // RS
  },
  
  // 5-2-3 (압박 축구)
  '5-2-3': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (5명) - 파이브백 (모두 같은 x 좌표)
    '2:1': { x: 15, y: 5 },   // LWB (왼쪽 윙백은 위쪽)
    '2:2': { x: 15, y: 28 },  // LCB (왼쪽은 위쪽)
    '2:3': { x: 15, y: 50 },  // CB
    '2:4': { x: 15, y: 72 },  // RCB (오른쪽은 아래쪽)
    '2:5': { x: 15, y: 95 },  // RWB (오른쪽 윙백은 아래쪽)
    // MID (2명) - 더블 피봇 (같은 x 좌표)
    '3:1': { x: 24, y: 35 },  // LCM (왼쪽은 위쪽)
    '3:2': { x: 24, y: 65 },  // RCM (오른쪽은 아래쪽)
    // FW (3명) - 쓰리톱 (같은 x 좌표)
    '4:1': { x: 40, y: 12 },  // LW (왼쪽 윙은 위쪽)
    '4:2': { x: 40, y: 50 },  // CF
    '4:3': { x: 40, y: 88 },  // RW (오른쪽 윙은 아래쪽)
    '5:1': { x: 40, y: 50 },  // Alternative CF
  },

  // 4-1-4-1 (수비형 미드필더 하나)
  '4-1-4-1': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (4명) - 골키퍼와 매우 가깝게, 최대한 넓게
    '2:1': { x: 10, y: 10 },  // LB - 최대 사이드
    '2:2': { x: 10, y: 35 },  // LCB - 넓게
    '2:3': { x: 10, y: 65 },  // RCB - 넓게
    '2:4': { x: 10, y: 90 },  // RB - 최대 사이드
    // DM (1명) - 중앙 수비형 미드필더
    '3:1': { x: 20, y: 50 },  // CDM (홀로 중앙)
    // MID (4명) - 공격형 미드필더
    '4:1': { x: 30, y: 8 },   // LM - 사이드
    '4:2': { x: 30, y: 33 },  // LCM
    '4:3': { x: 30, y: 67 },  // RCM
    '4:4': { x: 30, y: 92 },  // RM - 사이드
    // FW (1명)
    '5:1': { x: 42, y: 50 },  // ST
  },

  // 4-4-1-1 (미드필드 다이아몬드)
  '4-4-1-1': {
    // GK
    '1:1': { x: 5, y: 50 },
    // DEF (4명) - 골키퍼와 매우 가깝게, 최대한 넓게
    '2:1': { x: 10, y: 10 },  // LB - 최대 사이드
    '2:2': { x: 10, y: 35 },  // LCB - 넓게
    '2:3': { x: 10, y: 65 },  // RCB - 넓게
    '2:4': { x: 10, y: 90 },  // RB - 최대 사이드
    // MID (4명) - 다이아몬드 형태
    '3:1': { x: 18, y: 50 },  // CDM (후방)
    '3:2': { x: 25, y: 25 },  // LCM
    '3:3': { x: 25, y: 75 },  // RCM
    '3:4': { x: 30, y: 50 },  // CAM (전방)
    // SS/CF (1명) - 세컨드 스트라이커
    '4:1': { x: 36, y: 50 },  // SS
    // FW (1명)
    '5:1': { x: 42, y: 50 },  // ST
  }
}

// 원정팀 위치 생성 (홈팀 기준으로 자동 변환)
function generateAwayPositions(homePositions: FormationPositions): FormationPositions {
  const awayPositions: FormationPositions = {}
  
  for (const [key, pos] of Object.entries(homePositions)) {
    // x축 반전 (홈팀 0-50 -> 원정팀 50-100)
    // y축 반전 (좌우 미러링)
    awayPositions[key] = {
      x: 100 - pos.x,  // x축 반전
      y: 100 - pos.y   // y축 반전 (좌우 미러링)
    }
  }
  
  return awayPositions
}

// 원정팀 포메이션 생성
const AWAY_FORMATIONS: { [formation: string]: FormationPositions } = {}
for (const [formation, positions] of Object.entries(HOME_FORMATIONS)) {
  AWAY_FORMATIONS[formation] = generateAwayPositions(positions)
}

// 기본 포지션 (포메이션 정보가 없을 때)
const DEFAULT_POSITIONS = {
  home: {
    '1:1': { x: 5, y: 50 },    // GK
    '2:1': { x: 10, y: 10 },   // DEF - 골키퍼와 가깝게, 넓게
    '2:2': { x: 10, y: 30 },
    '2:3': { x: 10, y: 50 },   // 중앙
    '2:4': { x: 10, y: 70 },
    '2:5': { x: 10, y: 90 },   // 5번째 수비수
    '3:1': { x: 24, y: 15 },   // MID
    '3:2': { x: 24, y: 35 },
    '3:3': { x: 24, y: 50 },   // 중앙
    '3:4': { x: 24, y: 65 },
    '3:5': { x: 24, y: 85 },   // 5번째 미드필더
    '4:1': { x: 34, y: 12 },   // ATT
    '4:2': { x: 34, y: 50 },   // 중앙
    '4:3': { x: 34, y: 88 },   // 오른쪽
    '4:4': { x: 34, y: 35 },   // 4번째 공격수
    '5:1': { x: 42, y: 35 },   // FW (왼쪽)
    '5:2': { x: 42, y: 65 },   // 2번째 FW (오른쪽)
    '5:3': { x: 42, y: 50 },   // 3번째 FW (중앙)
  },
  away: {}
}
DEFAULT_POSITIONS.away = generateAwayPositions(DEFAULT_POSITIONS.home)

// 포지션 가져오기 함수
export function getPosition(
  grid: string, 
  isHomeTeam: boolean, 
  formation?: string
): Position {
  // 포메이션이 있으면 해당 포메이션 사용
  if (formation) {
    const positions = isHomeTeam ? HOME_FORMATIONS[formation] : AWAY_FORMATIONS[formation]
    if (positions && positions[grid]) {
      return positions[grid]
    }
  }
  
  // 포메이션이 없거나 매칭되지 않으면 기본값 사용
  const defaultPos = isHomeTeam ? DEFAULT_POSITIONS.home : DEFAULT_POSITIONS.away
  return defaultPos[grid] || { x: isHomeTeam ? 25 : 75, y: 50 }
}

// 지원하는 포메이션 목록
export const SUPPORTED_FORMATIONS = [
  '4-4-2',
  '4-3-3',
  '4-2-3-1',
  '3-5-2',
  '5-4-1',
  '4-5-1',
  '3-4-3',
  '5-3-2',
  '4-1-4-1',
  '4-4-1-1',
  '3-4-2-1',
  '4-2-2-2',
  '5-2-3'
]

// Export formations for debugging
export { HOME_FORMATIONS, AWAY_FORMATIONS, DEFAULT_POSITIONS }